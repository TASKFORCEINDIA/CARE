<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>CARE</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
body{background:#f7f8fa;color:#111}
.screen{display:none;padding:22px}
.screen.active{display:block}
#splash{position:fixed;inset:0;background:#0a6cf1;color:#fff;display:flex;align-items:center;justify-content:center;font-size:34px;letter-spacing:3px;z-index:10}
.btn{width:100%;padding:16px;margin:10px 0;border:none;border-radius:10px;background:#111;color:#fff;font-size:16px}
.btn.green{background:#25D366}
.btn.light{background:#eaeaea;color:#111}
.list button{width:100%;padding:14px;margin:8px 0;border:1px solid #ddd;border-radius:8px;background:#fff;text-align:left}
.qty{display:flex;align-items:center;gap:12px;margin:10px 0}
.qty button{width:38px;height:38px;border-radius:8px;border:1px solid #ccc;background:#fff;font-size:18px}
.small{font-size:14px;color:#666}
.center{text-align:center}
.itemBox{border-bottom:1px solid #ddd;padding:10px 0}
.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.badge{background:#111;color:#fff;border-radius:14px;padding:4px 10px;font-size:13px}
</style>
</head>

<body>

<div id="splash">CARE</div>

<!-- HOME -->
<div id="home" class="screen active center">
  <h2>CARE</h2><br/>
  <button class="btn" onclick="go('categories')">Requirement</button>
  <button class="btn green" onclick="sendPOonWhatsApp()">Contact on WhatsApp</button>

</div>

<!-- CATEGORIES -->
<div id="categories" class="screen">
  <h2>Requirement</h2>
  <div class="list">
    <button onclick="openCategory('Medical Consumables')">Medical Consumables</button>
    <button onclick="openCategory('Lab Consumables')">Lab Consumables</button>
    <button onclick="openCategory('Infection Control')">Infection Control</button>
  </div>
  <button class="btn light" onclick="go('home')">Back</button>
</div>

<!-- SUBCATS -->
<div id="subcats" class="screen">
  <div class="topbar">
    <h2 id="subTitle"></h2>
    <div class="badge" onclick="go('review')">Review (<span id="count">0</span>)</div>
  </div>
  <div class="list" id="subList"></div>
  <button class="btn light" onclick="go('categories')">Back</button>
</div>

<!-- ITEMS -->
<div id="items" class="screen">
  <div class="topbar">
    <h2 id="itemTitle"></h2>
    <div class="badge" onclick="go('review')">Review (<span id="count2">0</span>)</div>
  </div>
  <div class="list" id="itemList"></div>
  <button class="btn light" onclick="go('subcats')">Back</button>
</div>

<!-- ADD ITEM -->
<div id="addItem" class="screen">
  <h2 id="addItemTitle"></h2>
<p class="small" id="unitText"></p>
<p class="small">No order placed yet</p>
<div class="qty">

    <button onclick="changeQty(-1)">â€“</button>
    <span id="qty">0</span>
    <button onclick="changeQty(1)">+</button>
  </div>
  <button class="btn" onclick="addToRequirement()">Add to Requirement</button>
  <div class="small">Item added to requirement. Review anytime.</div>
  <button class="btn light" onclick="go('items')">Back</button>
</div>

<!-- REVIEW -->
<div id="review" class="screen">
  <h2>Requirement Review</h2>
  <p class="small">This is not an order</p><br/>
  <div id="reviewList"></div>
  <button class="btn" onclick="proceedToPO()">Proceed to PO</button>
  <button class="btn light" onclick="cancelAll()">Cancel</button>
</div>

<!-- PO FLOW -->
<div id="po1" class="screen center">
  
  <h2>Generate Purchase Order</h2>
  <p class="small">You can review before confirming</p><br/>
  <strong>XYZ-HOSP-PO-001</strong><br/><br/>
  <button class="btn" onclick="go('poDetails')">Generate PO</button>

  <button class="btn light" onclick="go('review')">Back</button>
  </div>
<div id="poDetails" class="screen">
  <h2>PO Details</h2>

  <input id="orgName" placeholder="Hospital / Lab Name" class="input" />
  <input id="orgAddress" placeholder="Delivery Address" class="input" />
  <input id="contactName" placeholder="Raised By (Name & Role)" class="input" />
  <input id="contactPhone" placeholder="Contact Mobile Number" class="input" />

  <label class="small">
    <input type="checkbox" id="authConfirm" />
    I confirm I am authorised to raise this requirement
  </label>

  <button class="btn" onclick="confirmPODetails()">Continue</button>
  <button class="btn light" onclick="go('po1')">Back</button>
</div>


<div id="po2" class="screen center">
  <h2>Confirm Purchase Order</h2>
  <p class="small">No order placed without final confirmation</p><br/>
  <button class="btn" onclick="go('po3')">Confirm PO</button>
  <button class="btn light" onclick="go('review')">Edit</button>
</div>

<div id="po3" class="screen center">
  <h2>Final Confirmation</h2>
  <p class="small">You can cancel before supplier confirmation</p><br/>
  <button class="btn" onclick="sendPOonWhatsApp()">Final Confirm</button>

  <button class="btn light" onclick="cancelAll()">Cancel</button>
</div>

<script>
const catalog={
 "Medical Consumables":{
  "Syringes":["2ml","5ml","10ml","Insulin"],
  "Gloves":["Small","Medium","Large","XL"],
  "IV Sets":["Adult","Paediatric"],
  "Needles":["22G","23G","24G"],
  "Dressings":["Gauze","Cotton Rolls"]
 },
 "Lab Consumables":{
  "Test Kits":["CBC","Sugar","Pregnancy"],
  "Sample Containers":["Urine","Stool"],
  "Vacutainers":["Red","Purple","Grey"],
  "Slides & Tubes":["Standard"]
 }
};

let category="", subcat="", item="", qty=0, cart=[];
  let poInfo = {};

const unitMap = {
  "Syringes": "Box of 100",
  "Gloves": "Box of 100",
  "Needles": "Box of 100",
  "IV Sets": "Pack of 25",
  "Dressings": "Pack of 10"
};

function go(id){
 document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
 document.getElementById(id).classList.add('active');
 updateCounts();
}

function openCategory(c){
 category=c;
 document.getElementById('subTitle').innerText=c;
 const list=document.getElementById('subList');
 list.innerHTML="";
 Object.keys(catalog[c]).forEach(s=>{
  const b=document.createElement('button');
  b.textContent=s;
  b.onclick=()=>openItems(s);
  list.appendChild(b);
 });
 go('subcats');
}

function openItems(s){
 subcat=s;
 document.getElementById('itemTitle').innerText=s;
 const list=document.getElementById('itemList');
 list.innerHTML="";
 catalog[category][s].forEach(v=>{
  const b=document.createElement('button');
  b.textContent=v;
  b.onclick=()=>selectItem(`${s} ${v}`);
  list.appendChild(b);
 });
 go('items');
}
function selectItem(name){
  item = name;
  qty = 0;

  document.getElementById('addItemTitle').innerText = name;

  let unit = "Standard pack";
  Object.keys(unitMap).forEach(k=>{
    if(name.includes(k)) unit = unitMap[k];
  });

  document.getElementById('unitText').innerText = "Unit: " + unit;
  document.getElementById('qty').innerText = qty;

  go('addItem');
}



function changeQty(v){
 qty=Math.max(0,qty+v);
 document.getElementById('qty').innerText=qty;
}

function addToRequirement(){
 if(qty===0){ alert("Please select quantity"); return; }
 const f=cart.find(x=>x.name===item);
 if(f) f.qty+=qty;
 else cart.push({name:item,qty});
 go('items');
}

function renderReview(){
 const r=document.getElementById('reviewList');
 r.innerHTML="";
 cart.forEach((x,i)=>{
  r.innerHTML+=`
   <div class="itemBox">
    ${x.name}
    <div class="qty">
     <button onclick="cartQty(${i},-1)">â€“</button>
     <span>${x.qty}</span>
     <button onclick="cartQty(${i},1)">+</button>
    </div>
   </div>`;
 });
}

function cartQty(i,v){
 cart[i].qty=Math.max(0,cart[i].qty+v);
 if(cart[i].qty===0) cart.splice(i,1);
 updateCounts();
}

function updateCounts(){
 document.getElementById('count').innerText=cart.length;
 document.getElementById('count2').innerText=cart.length;
 renderReview();
}


function proceedToPO(){
  if(cart.length===0){
    alert("No items in requirement");
    return;
  }
  go('po1');
}

 
  function confirmPODetails(){
  const name = document.getElementById('orgName').value.trim();
  const addr = document.getElementById('orgAddress').value.trim();
  const person = document.getElementById('contactName').value.trim();
  const phone = document.getElementById('contactPhone').value.trim();
  const ok = document.getElementById('authConfirm').checked;

  if(!name || !addr || !person || !phone || !ok){
    alert("Please fill all details and confirm authority");
    return;
  }

  poInfo = { name, addr, person, phone };
  go('po2');
}

function sendPOonWhatsApp(){
  let msg = "CARE â€“ Purchase Requirement\n\n";

  msg += "Hospital / Lab:\n";
msg += poInfo.name + "\n";
msg += poInfo.addr + "\n\n";

msg += "Raised By:\n";
msg += poInfo.person + "\n";
msg += "Contact: " + poInfo.phone + "\n\n";

msg += "Items:\n";
cart.forEach(x=>{
  msg += `â€¢ ${x.name} â€“ ${x.qty}\n`;
});

msg += "\nGenerated via CARE";


  const phone = "918179456654"; // ðŸ”´ replace with any number for testing
  const url = "https://wa.me/" + phone + "?text=" + encodeURIComponent(msg);

  window.open(url, "_blank");
}

function cancelAll(){
 if(confirm("Cancel and clear all items?")){
  cart=[]; go('home');
 }
}

setTimeout(()=>{document.getElementById('splash').style.display='none'},1200);
</script>

</body>
</html>
